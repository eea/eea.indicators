<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="indicators">
  <head>
  <title tal:content="context/Title"></title>
  </head>

  <metal:javascript fill-slot="javascript_head_slot">
<script type="text/javascript"
    tal:attributes="src string:${context/portal_url}/++resource++indicators-toc.js">
 </script>

  </metal:javascript>

  <body>
    <div metal:fill-slot="content-title" class="assessment_view" >
      <h1 class="documentFirstHeading" tal:content="context/Title">Title here</h1>
    </div>
    <div metal:fill-slot="content-description"></div>
    <div metal:fill-slot="content-core" tal:define="specification context/getParentNode" class='assessment_view' id='region-content'>
      <div id="content-more-updates-on"
        class="system-message warningMessage"
        tal:condition="context/getMore_updates_on"
        tal:content="structure context/getMore_updates_on" />

      <metal:versions use-macro="here/portlet_versions/macros/versions">
        <metal:new fill-slot="old" />
      </metal:versions>


      <div id="box-classification">
      <h4>Generic metadata</h4>
      <div id="box-classification-col1">
        <tal:block define="themesView specification/@@themes-object|nothing;
          themes themesView/full_items;
          primaryTheme python:themes and themes[0] or None">
          <strong>Topics</strong>:<br /><br />
          <tal:primaryTheme repeat="theme themes" condition="primaryTheme">
            <a href="" title="" style="text-decoration: none"
              tal:attributes="href theme_url;
              title theme_title"
              tal:define="theme_title python:theme['title'];
              theme_url python:theme['url'];
              theme_image python:theme['image']">
              <img alt="" src=""
                tal:attributes="alt theme_title;
                src theme_image" />
              <tal:block replace="theme_title" />
            </a> <span tal:condition="python:theme == themes[0]">(Primary topic)</span>
            <br /><br />
          </tal:primaryTheme>
        </tal:block>
        <tal:tags define="facetId string:c9">
          <metal:related use-macro="here/dataset_view/macros/tags" />
        </tal:tags>
        <div class="visualClear"><!-- --></div>
        <strong>DPSIR</strong>: <span tal:define="dpsirLabel nocall:context/@@dpsir_label"
          tal:replace="python:dpsirLabel(context.getDpsir())" />
        <br/>
        <strong>Typology</strong>: <span tal:define="typologyLabel nocall:context/@@typology_label"
          tal:replace="python:typologyLabel(context.getTypology())" />
        </div>
        <div id="box-classification-col2">
         <div tal:define="codes context/getCodes">
          <strong>Indicator codes</strong>
          <ul>
            <li tal:repeat="code codes" tal:content="string:${code/set} ${code/code}">CSI 001</li>
          </ul>
         </div>
         <metal:related use-macro="here/dataset_view/macros/temp-coverage" />
         <metal:related use-macro="here/dataset_view/macros/geo-coverage" />
        </div>
      </div>
      
      <div class="visualClear">&nbsp;</div>
      <tal:block define="queryString string:h2">
        <metal:toc use-macro="here/portlet_toc/macros/portlet"/>
      </tal:block>
      
      <div class="metadata-switch metadata-switch-show standardButton">Switch to full indicator view</div>

      <div class="visualClear"><!-- --></div>
      <div class="metadata-info-switchable">
        <metal:definition-and-units use-macro="specification/@@view/macros/definition-and-units" />
      </div>
      <br class="visualClear" />
      <div tal:define="assessments context/get_assessments;
        key nocall:assessments/key;
        secondary assessments/secondary;">
        <div tal:condition="key" >
          <h2 class="policy_question">Key policy question: <span tal:replace="key/Title" /></h2>
          <div class="keyMessage">
            <h3>Key messages</h3>
            <p tal:content="structure context/getKey_message" />
          </div>

          <tal:figures define="relatedItems nocall:key/@@related_items;
            eea_figures python:relatedItems('EEAFigure')">
            <div tal:repeat="figure eea_figures" class="indicator-figure-plus-container">
              <div class="indicator-figure-plus" tal:attributes="id figure/getId">
                <div class="indicator-figure-image">
                  <a title="Downloads and more info" href="" tal:attributes="href figure/absolute_url">
                    <img alt="" title="" src=""
                      tal:attributes="alt figure/Title;
                      title figure/Title;
                      src string:${figure/absolute_url}/image_preview" />
                  </a>
                </div>

                <p class="figure-title" tal:content="figure/Title" />

                <tal:description define="figure_description figure/Description">
                  <p>
                    <strong>Note: </strong>
                    <span tal:condition="figure_description" tal:content="figure_description" />
                    <span tal:condition="not:figure_description">N/A</span>
                  </p>
                </tal:description>

<!--TODO: confirm that we never show figure/getDataSource-->
                <!--<tal:dataSource define="figure_dataSource figure/getDataSource">-->
                  <!--<p>-->
                    <!--<strong>Data source: </strong>-->
                    <!--<span tal:condition="not:figure_dataSource">N/A</span>-->
                  <!--</p>-->
                  <!--<p tal:condition="figure_dataSource" tal:content="structure figure_dataSource" />-->
                <!--</tal:dataSource>-->

                <div tal:define="related python:[o for o in figure.getRelatedProducts() 
                                                            if o.portal_type in ('ExternalDataSpec', 'Data')];">
                    <strong>Data source:</strong>
                    <p tal:repeat="item related" >
                        <tal:cond condition="python:item.portal_type == 'ExternalDataSpec'" >
                            <tal:def tal:define="field python:item.getField('provider_url'); value python:field.getAccessor(item)()">
                                <!--<span tal:content="python:field, value, item" />-->
                                <span tal:content="python:item.getOrganisationByUrl(value).Title" />:
                                <a 
                                    tal:content="item/Title" 
                                    tal:attributes="href python:item.getDataset_url() or value">External Data Spec</a>
                            </tal:def>
                        </tal:cond>

                        <tal:cond condition="python:item.portal_type == 'Data'" >
                            <tal:def tal:define="field python:item.getField('dataOwner'); value python:field.getAccessor(item)()">
                                <!--<span tal:content="python:field, value, item" />-->
                                <span tal:content="python:item.getOrganisationName(value).Title" />:
                                <a 
                                    tal:content="item/Title" 
                                    tal:attributes="href item/absolute_url">Data Item</a>
                            </tal:def>
                        </tal:cond>
                    </p>
                </div>

                <a tal:attributes="href figure/absolute_url">Downloads and more info</a>
                <div class="visualClear"><!-- --></div>

              </div>
            </div>
          </tal:figures>

          <h3>Key assessment</h3>
          <div tal:replace="structure python:key.getAssessment()">Question here</div>
        </div>

        <tal:parts repeat="part secondary">
          <h2 class="policy_question">Specific policy question: <span tal:replace="part/Title" /></h2>

          <tal:figures define="relatedItems nocall:part/@@related_items;
            eea_figures python:relatedItems('EEAFigure')">
            <div tal:repeat="figure eea_figures" class="indicator-figure-plus-container">
              <div class="indicator-figure-plus" tal:attributes="id figure/getId">
                <div class="indicator-figure-image">
                  <a title="Downloads and more info"
                    href=""
                    tal:attributes="href figure/absolute_url">
                    <img alt="" title="" src=""
                      tal:attributes="alt figure/Title;
                      title figure/Title;
                      src string:${figure/absolute_url}/image_preview" />
                  </a>
                </div>

                <p class="figure-title" tal:content="figure/Title" />

                <tal:description define="figure_description figure/Description">
                  <p>
                    <strong>Note: </strong>
                    <span tal:condition="figure_description" tal:content="figure_description" />
                    <span tal:condition="not:figure_description">N/A</span>
                  </p>
                </tal:description>

                <tal:dataSource define="figure_dataSource figure/getDataSource">
                  <p>
                    <strong>Data source: </strong>
                    <span tal:condition="not:figure_dataSource">N/A</span>
                  </p>
                  <p tal:condition="figure_dataSource" tal:content="structure figure_dataSource" />
                </tal:dataSource>

                <a tal:attributes="href figure/absolute_url">Downloads and more info</a>
                <div class="visualClear"><!-- --></div>

              </div>
            </div>
          </tal:figures>

          <h3>Specific assessment</h3>
          <div tal:replace="structure part/assessment">Question here</div>
        </tal:parts>
      </div>

      <h2 id="data_specifications">Data sources</h2>
      <ul tal:define="datasetsView nocall:specification/@@related_items;
        datasets python:datasetsView('Data'); extdatasets python:datasetsView('ExternalDataSpec')">
        <li tal:repeat="data datasets" tal:condition="datasets">
          <span tal:repeat="url python:data.getDataOwner()">
           <tal:organisations condition="python:specification.getOrganisationName(url)">
            <strong tal:content="python:specification.getOrganisationName(url).Title" />
            <span tal:condition="not: repeat/url/end" tal:replace="string:, " />
            <span tal:condition="repeat/url/end" tal:replace="string:: " />
           </tal:organisations>
          </span>
          <a href=""
            tal:attributes="href string:${context/portal_url}/data-and-maps/data/ds_resolveuid/${data/@@getLatestVersionLink}"
            tal:content="data/title">Dataset title</a> (downloadable at EEA)
        </li>
        <li tal:repeat="data extdatasets" tal:condition="extdatasets">
          <span tal:repeat="url python:data.getProvider_url()">
            <tal:organisations condition="python:specification.getOrganisationName(url)">
      	    <strong tal:content="python:specification.getOrganisationName(url).Title" />
            <span tal:condition="not: repeat/url/end" tal:replace="string:, " />
            <span tal:condition="repeat/url/end" tal:replace="string:: " />
            </tal:organisations>
       	  </span>
          <a href=""
            tal:attributes="href data/absolute_url"
            tal:content="data/title">Dataset title</a> (external data reference)
        </li>
        <li tal:condition="python:(not extdatasets and not datasets)">No datasets have been specified.</li>
      </ul>

      <div class="indicator-metadata-info">
        <metal:justification use-macro="specification/@@view/macros/justification-and-references" />
      </div>
      <div class="metadata-info-switchable">
        <metal:policy use-macro="specification/@@view/macros/policy-context-and-references" />
      </div>
      <div class="metadata-info-switchable">
        <metal:methodology use-macro="specification/@@view/macros/methodology-and-references" />
      </div>
      <div class="metadata-info-switchable">
        <metal:uncertainties use-macro="specification/@@view/macros/uncertainties-part" />
      </div>

      <h2 id="methodology">More information about this indicator</h2>
      <p>See this <a href="..">indicator specification</a> for more details.</p>

      <div id="contact-and-ownership">
      <h2>Contacts and ownership</h2>
        <h4>EEA Contact Info</h4>
        <tal:contact define="manager_id context/getManager_user_id">
          <tal:manager condition="manager_id">
            <tal:block define="manager_ob context/@@indicator_contact_info">
              <a href=""
                tal:condition="manager_ob"
                title="Contact indicator manager"
                tal:attributes="href string:http://www.eionet.europa.eu/sitedirsearch?name=${manager_ob/username}"
                tal:content="manager_ob/fullname">Contact</a>
              <p tal:condition="not:manager_ob">
                <span>User not found:</span>
                <tal:manager_id tal:content="manager_id" />
              </p>
            </tal:block>
          </tal:manager>
          <tal:contact condition="not:manager_id">
            <p>no contact info</p>
          </tal:contact>
        </tal:contact>

        <h4>Ownership</h4>
        <ul>
          <li tal:repeat="info context/getOwnership" >
            <!--TODO: this uses aquisition, refactor-->
            <a tal:content="python:context.getOrganisationName(info).Title" tal:attributes="href info" tal:on-error="python:info">EEA</a>
          </li>
        </ul>

        <h4>EEA Management Plan</h4>
        <a href=""
          tal:attributes="href python:'http://applications/managementplan/ProjectPlan.aspx?year=%s&code=%s' % context.getManagement_plan()"
          tal:content="python:'%s %s' % context.getManagement_plan()"></a>(note: EEA internal system)
      </div>

      <div id="timestamps-info">
        <h4>Dates</h4>
        <div>
          First draft created: <span tal:content="context/creation_date">creation date</span>
        </div>

        <div>
          Publish date: <span tal:content="context/EffectiveDate">effective date</span>
        </div>

        <div>
          Last modified: <span tal:content="context/modified">Modified date</span>
        </div>
      </div>

      <div id="permalinks-info">
        <h4>Permalinks</h4>
        <metal:basicmeta use-macro="context/versions_macros/macros/permalinks" />
      </div>

     <metal:versions use-macro="here/portlet_versions/macros/versions">
        <metal:new fill-slot="new" />
      </metal:versions>
    </div>
  </body>
</html>
