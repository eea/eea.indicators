<div tal:replace="nothing" tal:define="unused_dummy python:request.set('disable_plone.rightcolumn', True)" />
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eea">
  <head>
  <title tal:content="context/Title"></title>

  <metal:javascript fill-slot="javascript_head_slot">
    <script type="text/javascript"
        tal:attributes="src string:${context/portal_url}/++resource++indicators-toc.js">
    </script>

    <script tal:replace="structure context/embed-inline-includes"> </script>
    <script type="text/javascript" tal:condition="python:context.portal_membership.checkPermission('Modify portal content', context)"
        tal:attributes="src string:${context/portal_url}/++resource++daviz-inline-resize.js">
    </script>

  <script type="text/javascript">
    jQuery(document).ready(function($){
        jQuery(".embedded-daviz-visualization").find("ul.formTabs a").bind("click", function(){
            var embedded_obj = jQuery("#fieldset-"+jQuery(this).attr("id").substr(15)).find(".googlechart_dashboard")
            if ((embedded_obj.length === 0) || (embedded_obj[0].innerHTML.trim().length != 0)){
                return;
            }
            var id = embedded_obj.attr("id").substr(22);
            if (embedded_obj.hasClass("isChart")){
                drawChart(window["settings_" + id], window["other_options_" + id]);
            }
            else{
                drawDashboardEmbed(window["settings_" + id]);
            }
        });
        jQuery(".embedded-daviz-visualization").find("select.formTabs").bind("change", function(){
            var embedded_obj = jQuery("#fieldset-"+jQuery(this).attr("value").substr(15)).find(".googlechart_dashboard")
            if ((embedded_obj.length === 0) || (embedded_obj[0].innerHTML.trim().length != 0)){
                return;
            }
            var id = embedded_obj.attr("id").substr(22);
            if (embedded_obj.hasClass("isChart")){
                drawChart(window["settings_" + id], window["other_options_" + id]);
            }
            else{
                drawDashboardEmbed(window["settings_" + id]);
            }
        });

    });
  </script>

  </metal:javascript>
  </head>

  <body>
    <div metal:fill-slot="content-title" class="assessment_view" >
      <h1 class="documentFirstHeading" tal:content="context/Title">Title here</h1>
    </div>

    <div metal:fill-slot="content-description"></div>
    <div metal:fill-slot="content-core" tal:define="specification context/getParentNode"
    class='assessment_view'>
      <div id="content-more-updates-on"
        class="system-message warningMessage"
        tal:condition="context/getMore_updates_on"
        tal:content="structure context/getMore_updates_on" />

      <div tal:condition="not:isAnon" tal:replace="structure context/@@readiness" />

      <div id="frequency_of_updates" class="system-message"
            tal:content="context/get_frequency_of_updates"
            tal:condition="context/is_discontinued"/>

      <div class="visualClear">&nbsp;</div>
      <tal:block define="queryString string:h2">
        <metal:toc use-macro="here/portlet_toc/macros/portlet"/>
      </tal:block>


      <div class="visualClear"><!-- --></div>
      <metal:definition-and-units use-macro="specification/@@view/macros/definition-and-units" />
      <br class="visualClear" />
      <div tal:define="assessments context/get_assessments;
        key nocall:assessments/key;
        secondary assessments/secondary;">
        <div tal:condition="python:key">
          <h2 class="policy_question" i18n:translate="">Key policy question: <span tal:content="key/Title" i18n:name="title"></span></h2>
          <div class="keyMessage">
            <h3 i18n:translate="">Key messages</h3>
            <p tal:replace="structure context/getKey_message" />
          </div>

          <tal:figures tal:replace="structure key/@@figures" />

          <h3 i18n:translate="">Key assessment</h3>
          <div tal:replace="structure python:key.getAssessment()">Question here</div>
        </div>

        <tal:parts repeat="part secondary">
          <h2 class="policy_question" i18n:translate="">
              Specific policy question: <span tal:replace="part/Title" i18n:name="title" />
          </h2>

	  <tal:figures tal:replace="structure part/@@figures" />

          <h3 i18n:translate="">Specific assessment</h3>
          <div tal:replace="structure part/assessment">Question here</div>
        </tal:parts>
      </div>

      <h2 id="data_specifications" i18n:translate="">Data sources</h2>
      <ul tal:define="datasetsView nocall:specification/@@related_items;
        datasets python:datasetsView('Data'); extdatasets python:datasetsView('ExternalDataSpec')">
        <li tal:repeat="data datasets" tal:condition="python:datasets">
	  <a href=""
            tal:attributes="href string:${context/portal_url}/data-and-maps/data/ds_resolveuid/${data/@@getVersions/versionId}"
            tal:content="data/title">Dataset title</a><br/>provided by
          <span tal:repeat="url python:data.getDataOwner()">
           <tal:organisations condition="python:specification.getOrganisationName(url)">
            <strong tal:content="python:specification.getOrganisationName(url).Title" />
            <span tal:condition="not:repeat/url/end" tal:replace="string:, " />
           </tal:organisations>
          </span>
        </li>
        <li tal:repeat="data extdatasets" tal:condition="python:extdatasets">
	  <a href=""
            tal:attributes="href data/absolute_url"
            tal:content="data/title">Dataset title</a><br/>provided by
          <span tal:define="url python:data.getProvider_url()">
            <tal:organisations condition="python:specification.getOrganisationName(url)">
      	    <strong tal:content="python:specification.getOrganisationName(url).Title" />
            </tal:organisations>
       	  </span>
        </li>
        <li tal:condition="python:(not extdatasets and not datasets)">No datasets have been specified.</li>
      </ul>

      <div class="indicator-metadata-info">
        <metal:justification use-macro="specification/@@view/macros/justification-and-references" />
      </div>
        <metal:policy use-macro="specification/@@view/macros/policy-context-and-references" />
        <metal:methodology use-macro="specification/@@view/macros/methodology-and-references" />
        <metal:uncertainties use-macro="specification/@@view/macros/uncertainties-part" />

      <h2 id="methodology" i18n:translate="">More information about this indicator</h2>
      <p i18n:translate="">See this
          <tal:specs i18n:name="indicator-specs"><a href=".." class="link-plain" i18n:translate="">indicator specification</a></tal:specs> for more details.</p>

       <!--? metadata -->
        <div id="box-classification">
            <h4 i18n:translate="">Generic metadata</h4>
            <div id="box-classification-col1">
                <tal:block define="themesView specification/@@themes-object|nothing;
          themes themesView/full_items;
          primaryTheme python:themes and themes[0] or None">
                    <strong i18n:translate="">Topics</strong>:<br /><br />
                    <tal:primaryTheme repeat="theme themes"
                                      condition="python:primaryTheme">
                        <a href="" title="" style="text-decoration: none"
                                tal:attributes="href theme_url;
                                        title theme_title"
                                tal:define="theme_title python:theme['title'];
                                        theme_url python:theme['url'];
                                                theme_image python:theme['image']">
                            <img alt="" src=""
                                    tal:attributes="alt theme_title;
                                            src theme_image" />
                            <tal:block replace="theme_title" />
                        </a> <span tal:condition="python:theme == themes[0]">(Primary topic)</span>
                        <br /><br />
                    </tal:primaryTheme>
                </tal:block>
                <tal:tags define="facetId string:c9">
                    <metal:related use-macro="here/dataset_view/macros/tags" />
                </tal:tags>
                <div class="visualClear"><!-- --></div>
                <strong i18n:translate="">DPSIR</strong>: <span tal:define="dpsirLabel nocall:context/@@dpsir_label"
                    tal:replace="python:dpsirLabel(context.getDpsir())" />
                <br/>
                <strong i18n:translate="">Typology</strong>: <span tal:define="typologyLabel nocall:context/@@typology_label"
                    tal:replace="python:typologyLabel(context.getTypology())" />
            </div>
            <div id="box-classification-col2">
                <div tal:define="codes context/getCodes">
                    <strong i18n:translate="">Indicator codes</strong>
                    <ul>
                        <li tal:repeat="code codes" tal:content="string:${code/set} ${code/code}">CSI 001</li>
                    </ul>
                </div>
                <metal:related use-macro="context/temporal_macros/macros/temporal-coverage-data" />
                <metal:related use-macro="context/geotags_macros/macros/geotags-listing" />
                <metal:related use-macro="context/geotags_macros/macros/geotags-map" />
            </div>
        </div>

      <!--? /metadata -->

      <div id="contact-and-ownership">
      <h2 i18n:translate="">Contacts and ownership</h2>
        <h4 i18n:translate="">EEA Contact Info</h4>
        <tal:contact define="manager_id context/getManager_user_id">
          <tal:manager condition="python:manager_id">
            <tal:block define="manager_ob context/@@indicator_contact_info">
              <a href=""
                tal:condition="python:manager_ob"
                title="Contact indicator manager"
                i18n:attributes="title"
                tal:attributes="href string:http://www.eionet.europa.eu/users/${manager_ob/username}"
                tal:content="manager_ob/fullname">Contact</a>
              <p tal:condition="python:not manager_ob">
                <span i18n:translate="">User not found:</span>
                <tal:manager_id tal:content="manager_id" />
              </p>
            </tal:block>
          </tal:manager>
          <tal:contact condition="python:not manager_id">
            <p i18n:translate="">no contact info</p>
          </tal:contact>
        </tal:contact>

        <h4 i18n:translate="">Ownership</h4>
        <ul>
          <li tal:repeat="info context/getOwnership" >
            <!--TODO: this uses aquisition, refactor-->
            <a tal:content="python:context.getOrganisationName(info).Title" tal:attributes="href info" tal:on-error="python:info">EEA</a>
          </li>
        </ul>

        <h4 i18n:translate="">EEA Management Plan</h4>
        <a href=""
          tal:attributes="href python:'http://applications/managementplan/ProjectPlan.aspx?year=%s&amp;code=%s' % context.getManagement_plan()"
          tal:content="python:'%s %s' % context.getManagement_plan()"></a>
          <tal:block i18n:translate="">(note: EEA internal system)</tal:block>
      </div>

      <div id="timestamps-info">
        <h4 i18n:translate="">Dates</h4>

        <div i18n:translate="" class="metadata_date">
          First draft created: <metal:field i18n:name="creation-date" use-macro="python:context.widget('creation_date', mode='view')" />
        </div>
        <div i18n:translate="" class="metadata_date">
          Publish date: <metal:field i18n:name="effective-date" use-macro="python:context.widget('effectiveDate', mode='view')" />
        </div>
        <div i18n:translate="" class="metadata_date">
          Last modified: <metal:field i18n:name="modified-date" use-macro="python:context.widget('modification_date', mode='view')" />
        </div>

        <div tal:condition="context/should_show_frequency_of_updates">
            <h4 i18n:translate="">Frequency of updates</h4>
            <div tal:content="context/get_frequency_of_updates" />
          </div>
      </div>

      <div id="permalinks-info">
        <h4 i18n:translate="">Permalinks</h4>
        <metal:basicmeta use-macro="context/versions_macros/macros/permalinks" />
      </div>


    </div>
  </body>
</html>
