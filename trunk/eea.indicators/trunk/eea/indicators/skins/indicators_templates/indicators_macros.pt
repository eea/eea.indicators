<!-- TODO: remove the thiscontext variable, is not needed -->

<!-- Tooltip macro -->
<metal:tooltip define-macro="tooltip"
	tal:define="tooltip tooltip|field/widget/description|nothing"
	tal:condition="tooltip">
	<img class="eea-flexible-tooltip-bottom"
		src="information.png"
		title=""
		tal:attributes="src string:${portal_url}/information.png;
		title tooltip" />
</metal:tooltip>

<!-- Active region macro -->
<metal:macro metal:define-macro="active_region">
	<div class="active_region" tal:attributes="id region_name">
		<div class="content">
			<metal:slot metal:define-slot="content"></metal:slot>
		</div>
		<div class="metadata" tal:define="also_reload also_reload|nothing">
			<div class="region_update_handler" 
				tal:content="region_update_handler"></div>
			<div class="also_reload" tal:condition="also_reload">
				<span tal:repeat="reg also_reload" tal:content="reg" />
			</div>
			<metal:slot metal:define-slot="extra-metadata"></metal:slot>
		</div>
	</div>
	<div class="visualClear"><!-- --></div>
</metal:macro>

<!-- Active field macro -->
<div metal:define-macro="active_field" class="active_field" 
	tal:define="thiscontext nocall:thiscontext|context">
	<div class="control">
		<a href="" 
			tal:attributes="href string:${thiscontext/absolute_url}/${submit_handler}?fieldset=${fieldset}&specific_field=$fieldname">edit...</a>
	</div>
	<div class="content">
		<metal:slot metal:define-slot="content"></metal:slot>
	</div>
	<div class="metadata">
		<div class="fieldname" tal:content="fieldname" />
		<div class="submit_handler" tal:content="submit_handler" />
		<metal:slot metal:define-slot="extra-metadata"></metal:slot>
	</div>
</div>

<!-- Active reference field macro -->
<metal:macro metal:define-macro="active_relation_field">
	<div class="active_field" tal:attributes="id string:active_field-$fieldName" id="active_field-relatedItems">
		<form method="POST" action="" tal:attributes="action string:${context/absolute_url}/simple_edit">
			<input type="hidden" name="specific_field" tal:attributes="value fieldName" />
			<input type="hidden" name="form.submitted" value="1" />
			<input type="hidden" name="form_submit" value="Save" />
			<div class="content">
				<div tal:condition="python:not value" class="placeholder">
					Please fill in
				</div>
				<span metal:use-macro="here/eeareferencebrowser/macros/popup" >
					<div metal:fill-slot="script">
						<script type="text/javascript" tal:content="string:
							Faceted.Cleanup();;
							jQuery('.popup-tabs #faceted-form').remove();;
							var popup = new EEAReferenceBrowser.Widget('$fieldName');;
							$$(popup.events).bind(popup.events.SAVED, function(evt){
							ajaxify($$('#active_field-$fieldName'), '$fieldName');
							$$('#active_field-$fieldName form').trigger('submit');
							});
							"></script>
					</div>
				</span>
			</div>
		</form>
	</div>
</metal:macro>
