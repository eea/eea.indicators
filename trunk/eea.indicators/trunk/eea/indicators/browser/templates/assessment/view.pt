<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="indicators">
  <head>
  <title tal:content="context/Title"></title>
  </head>

  <metal:javascript fill-slot="javascript_head_slot">
    <script language="javascript" type="text/javascript">
      function figures_number() {
        var figures = jQuery(".figure-title");
        var count = 1;

        jQuery.each(figures, function(i, figure) {
          var figure_title = figure.innerHTML;
          figure.innerHTML = 'Fig. ' + count + ': ' + figure_title;
          count += 1;
        })
      }

      function setIndicatorsBtn() {
        jQuery("#indicator-metadata-more").click(function () { showIndicatorMetadata("more") });
        jQuery("#indicator-metadata-info").click(function () { showIndicatorMetadata("info") });
      };

      function showIndicatorMetadata(event) {
        if (event == "more") {
          jQuery("#indicator-metadata-more").fadeOut("slow", function() {
              jQuery("#indicator-metadata-info").fadeIn("slow");
                });
      };
        if (event == "info") {
          jQuery("#indicator-metadata-info").fadeOut("slow", function() {
              jQuery("#indicator-metadata-more").fadeIn("slow");
                });
      };
      }

      jQuery(document).ready(function () {
          figures_number();
          setIndicatorsBtn();
      });
    </script>
  </metal:javascript>

  <body>
		<div metal:fill-slot="main">
			<h1 id="assessment_title" tal:content="context/Title">Title here</h1>
			<tal:block define="queryString string:h2">
			    <metal:toc use-macro="here/portlet_toc/macros/portlet"/>
			</tal:block>


        <metal:versions use-macro="here/portlet_versions/macros/versions">
          <metal:new fill-slot="old" />
        </metal:versions>
        <metal:versions use-macro="here/portlet_versions/macros/versions">
          <metal:new fill-slot="new" />
        </metal:versions>

			<div tal:define="assessments context/get_assessments;
				key nocall:assessments/key;
				secondary assessments/secondary; "
				>
				<div tal:condition="key" >
					<h2 tal:content="key/Title" class="policy_question">Question here</h2>
					<div class="keyMessage">
						<h3>Key message</h3>
						<p tal:content="structure context/getKey_message" />
					</div>

          <tal:policy_documents define="relatedItems nocall:key/@@related_items;
                                        eea_figures python:relatedItems('EEAFigure')">

<div tal:repeat="figure eea_figures" class="indicator-figure-plus-container">
  <div class="indicator-figure-plus" tal:attributes="id figure/getId">
    <div class="indicator-figure-image">
      <a title="Downloads and more info"
         href=""
         tal:attributes="href figure/absolute_url">
           <img alt="" title="" src=""
                tal:attributes="alt figure/Title;
                                title figure/Title;
                                src string:${figure/absolute_url}/image_preview" />
      </a>
    </div>

    <p class="figure-title" tal:content="figure/Title" />

    <tal:description define="figure_description figure/Description">
      <p>
        <strong>Note: </strong>
        <span tal:condition="figure_description" tal:content="figure_description" />
        <span tal:condition="not:figure_description">N/A</span>
      </p>
    </tal:description>

    <tal:dataSource define="figure_dataSource figure/getDataSource">
      <p>
        <strong>Data source: </strong>
        <span tal:condition="not:figure_dataSource">N/A</span>
      </p>
      <p tal:condition="figure_dataSource" tal:content="structure figure_dataSource" />
    </tal:dataSource>

    <a tal:attributes="href figure/absolute_url">Downloads and more info</a>
    <br clear="all"/>

  </div>
</div>
          </tal:policy_documents>

					<h3>Key assessment</h3>
					<div tal:replace="structure python:key.getAssessment()">Question here</div>
				</div>

				<tal:parts repeat="part secondary">
					<h2 tal:content="part/Title" class="policy_question">Question here</h2>

          <tal:policy_documents define="relatedItems nocall:part/@@related_items;
                                        eea_figures python:relatedItems('EEAFigure')">

<div tal:repeat="figure eea_figures" class="indicator-figure-plus-container">
  <div class="indicator-figure-plus" tal:attributes="id figure/getId">
    <div class="indicator-figure-image">
      <a title="Downloads and more info"
         href=""
         tal:attributes="href figure/absolute_url">
           <img alt="" title="" src=""
                tal:attributes="alt figure/Title;
                                title figure/Title;
                                src string:${figure/absolute_url}/image_preview" />
      </a>
    </div>

    <p class="figure-title" tal:content="figure/Title" />

    <tal:description define="figure_description figure/Description">
      <p>
        <strong>Note: </strong>
        <span tal:condition="figure_description" tal:content="figure_description" />
        <span tal:condition="not:figure_description">N/A</span>
      </p>
    </tal:description>

    <tal:dataSource define="figure_dataSource figure/getDataSource">
      <p>
        <strong>Data source: </strong>
        <span tal:condition="not:figure_dataSource">N/A</span>
      </p>
      <p tal:condition="figure_dataSource" tal:content="structure figure_dataSource" />
    </tal:dataSource>

    <a tal:attributes="href figure/absolute_url">Downloads and more info</a>
    <br clear="all"/>

  </div>
</div>
          </tal:policy_documents>

					<h3>Specific assessment</h3>
					<div tal:replace="structure part/assessment">Question here</div>
				</tal:parts>
			</div>

			<h2 id="methodology">Methodology, data sources and references</h2>
			<p>See this <a href="..">indicator specification</a> for methodology,
				data sources, rationale and more relevant details.
			</p>

  <h2 class="specification">Specification metadata</h2>
  <div id="indicator-metadata-more">Click to read more</div>
  <div id="indicator-metadata-info"
       tal:define="specification context/getParentNode">
    <span id="hide-specification-info">Hide metadata</span>
    <h4 tal:content="specification/Title" />
    <p>TODO: Add the correxponding metadata from its parent specification.</p>
  </div>

			<h2 id="general_metadata">General metadata</h2>
			<div class='headed-box'>
				<h3>Responsability and ownership</h3>

				<h4>EEA Contact Info</h4>
				<tal:contact define="manager_id context/getManager_user_id">
				  <tal:manager condition="manager_id">
				    <tal:block define="manager_ob context/@@indicator_contact_info">
				      <a href=""
					 tal:condition="manager_ob"
					 title="Contact indicator manager"
					 tal:attributes="href string:http://www.eionet.europa.eu/sitedirsearch?name=${manager_ob/uid}"
					 tal:content="manager_ob/cn">Contact</a>
				      <p tal:condition="not:manager_ob">
					<span>User not found:</span>
					<tal:manager_id tal:content="manager_id" />
				      </p>
				    </tal:block>
				  </tal:manager>
				  <tal:contact condition="not:manager_id">
				    <p>no contact info</p>
				  </tal:contact>
				</tal:contact>

				<h4>Ownership</h4>
				<ul>
					<li tal:repeat="info context/getOwnership" >
						<a tal:content="python:context.getOrganisationName(info).Title" tal:attributes="href info">EEA</a>
					</li>
				</ul>

				<h4>EEA Management Plan</h4>
				<a href=""
					tal:attributes="href python:'http://applications/managementplan/showProject.asp?year=%s&code=%s' % context.getManagement_plan()"
					tal:content="python:'%s %s' % context.getManagement_plan()">

					</a>(note: EEA internal system)
			</div>

			<div class='headed-box'>
				<h3>Identification</h3>
				<div class="wrapper" >

					<div tal:define="codes context/getCodes">
						<strong>Indicator code</strong>
						<div tal:repeat="code codes" tal:content="string:${code/set} ${code/code}">
							CSI 001
						</div>
					</div>

					<div tal:replace="nothing">
						<div tal:condition="context/getSource_code" >
							<strong>Source Code</strong>
							<span tal:content="context/getSource_code" />
						</div>
					</div>

					<strong>Specification</strong>
					<div>Link: <a href="" tal:attributes="href context/absolute_url"
							tal:content="context/Title">Assessment</a>
					</div>

					<div>
						Version id: <tal:version_id define="getVersions nocall:context/@@getVersions;
										    version_number getVersions/version_number"
									    content="version_number" />
					</div>

					<div>
						First draft created: <span tal:content="context/creation_date">creation date</span>
					</div>

					<div>
						Publish date: <span tal:content="context/effective_date">effective date</span>
					</div>

					<div>
						Last modified: <span tal:content="context/modified">Modified date</span>
					</div>
				</div>
			</div>

			<div class='headed-box'>
				<h3>Classification</h3>
				<div class="visualClear"><!-- --></div>
				<strong>DPSIR</strong>: <span tal:replace="context/getDpsir" /><br/>
				<strong>Typology</strong>: <span tal:replace="context/getTypology" /><br/>
				<strong>EEA Themes</strong>:
				<ul>
					<li tal:repeat="theme context/getThemes" tal:content="theme" />
				</ul>
			</div>

		</div>
	</body>
</html>
